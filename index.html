<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<title>Els éssers vius i la cèl·lula</title>

<style>
body{
  font-family: Arial, sans-serif;
  background: linear-gradient(to right,#d6eaf8,#ebf5fb);
  margin:0;
  padding:20px;
}

h1{text-align:center;}

.page{
  display:none;
  max-width:900px;
  margin:auto;
  background:white;
  padding:30px;
  border-radius:15px;
  box-shadow:0 0 10px rgba(0,0,0,0.2);
}

.page.active{display:block;}

.readable span{
  cursor:pointer;
}

.highlight-normal{
  background:#fff176;
}

.highlight-slow{
  background:#81d4fa;
}

.controls{
  margin-top:20px;
  text-align:center;
  border-top:2px solid #ccc;
  padding-top:15px;
}

button{
  padding:8px 14px;
  margin:5px;
  border:none;
  border-radius:6px;
  background:#2e86c1;
  color:white;
  cursor:pointer;
}

button:hover{background:#21618c;}

.progress-container{
  width:100%;
  height:15px;
  background:#ddd;
  border-radius:10px;
  margin-top:15px;
}

.progress-bar{
  height:100%;
  width:0%;
  background:#28b463;
  border-radius:10px;
  transition:width 0.2s;
}

.option{
  display:block;
  margin:5px 0;
  padding:5px;
  cursor:pointer;
}

.option:hover{
  background:#f0f0f0;
}

.correct{color:green;font-weight:bold;}
.incorrect{color:red;font-weight:bold;}
</style>
</head>
<body>

<h1>ELS ÉSSERS VIUS I LA CÈL·LULA (Cicle Mitjà)</h1>

<script>
let pages;
let currentPage=0;

let words=[];
let currentIndex=0;
let speaking=false;
let paused=false;
let mode="normal";
let voices=[];

window.onload=function(){
  pages=document.querySelectorAll(".page");
  pages[0].classList.add("active");
  prepareText();
  loadVoices();
};

function loadVoices(){
  voices = speechSynthesis.getVoices();
  if(!voices.length){
    speechSynthesis.onvoiceschanged = () => {
      voices = speechSynthesis.getVoices();
    };
  }
}

function getVoice(){
  return voices.find(v => v.lang.includes("ca")) || null;
}

function showPage(index){
  stopReading();
  pages[currentPage].classList.remove("active");
  currentPage=index;
  pages[currentPage].classList.add("active");
  prepareText();
}

function nextPage(){ if(currentPage<pages.length-1) showPage(currentPage+1);}
function prevPage(){ if(currentPage>0) showPage(currentPage-1);}

function prepareText(){
  let readable=pages[currentPage].querySelector(".readable");
  if(!readable) return;

  readable.querySelectorAll("p, h2").forEach(el=>{
    let text=el.innerText;
    el.innerHTML="";
    text.split(" ").forEach((word)=>{
      let span=document.createElement("span");
      span.textContent=word+" ";
      el.appendChild(span);
    });
  });

  words=readable.querySelectorAll("span");

  words.forEach((span,i)=>{
    span.onclick=function(){
      currentIndex=i;
      startReading(mode);
    }
  });

  updateProgress();
}

function startReading(selectedMode){
  speechSynthesis.cancel();
  speaking=true;
  paused=false;
  mode=selectedMode;
  speakWord();
}

function speakWord(){
  if(!speaking || currentIndex>=words.length || paused) return;

  words.forEach(w=>{
    w.classList.remove("highlight-normal");
    w.classList.remove("highlight-slow");
  });

  let word=words[currentIndex];
  word.classList.add(mode==="normal"?"highlight-normal":"highlight-slow");

  let utter=new SpeechSynthesisUtterance(word.textContent);
  utter.lang="ca-ES";
  utter.voice=getVoice();

  utter.onend=function(){
    if(mode==="slow"){
      setTimeout(()=>{
        currentIndex++;
        updateProgress();
        speakWord();
      },1000);
    }else{
      currentIndex++;
      updateProgress();
      speakWord();
    }
  };

  speechSynthesis.speak(utter);
}

function pauseReading(){
  paused=true;
  speechSynthesis.cancel();
}

function resumeReading(){
  if(paused){
    paused=false;
    speakWord();
  }
}

function stopReading(){
  speaking=false;
  paused=false;
  speechSynthesis.cancel();
  words.forEach(w=>{
    w.classList.remove("highlight-normal");
    w.classList.remove("highlight-slow");
  });
  currentIndex=0;
  updateProgress();
}

function updateProgress(){
  let percent=(currentIndex/words.length)*100;
  let bar=pages[currentPage].querySelector(".progress-bar");
  if(bar) bar.style.width=percent+"%";
}

function selectOption(element,correct,resultId){
  let options=element.parentNode.querySelectorAll(".option");
  options.forEach(o=>o.style.fontWeight="normal");

  element.style.fontWeight="bold";

  if(correct){
    document.getElementById(resultId).innerHTML="<span class='correct'>Correcte!</span>";
  }else{
    document.getElementById(resultId).innerHTML="<span class='incorrect'>Incorrecte</span>";
  }
}
</script>

<!-- ================= TEORIA ================= -->

<div class="page">
<div class="readable">

<h2>1. Què és un ésser viu?</h2>

<p>Un ésser viu és tot allò que neix, creix, es relaciona i es reprodueix.</p>

<p>Els éssers vius fan tres funcions vitals:</p>

<p>Nutrició: mengen o fabriquen aliment per tenir energia.</p>

<p>Relació: noten el que passa al seu voltant i reaccionen.</p>

<p>Reproducció: poden tenir fills o descendència.</p>

</div>

<div class="progress-container">
<div class="progress-bar"></div>
</div>

<div class="controls">
<button onclick="startReading('normal')">Lectura normal</button>
<button onclick="startReading('slow')">Lectura lenta</button>
<button onclick="pauseReading()">Pausa</button>
<button onclick="resumeReading()">Reprendre</button>
<button onclick="stopReading()">Stop</button>
<button onclick="nextPage()">Següent</button>
</div>
</div>

<!-- ================= PREGUNTES ================= -->

<div class="page">
<div class="readable">

<h2>Preguntes</h2>

<p>1. Quina és una funció vital?</p>
<div>
<span class="option" onclick="selectOption(this,false,'r1')">Dormir</span>
<span class="option" onclick="selectOption(this,true,'r1')">Nutrició</span>
<span class="option" onclick="selectOption(this,false,'r1')">Córrer</span>
</div>
<p id="r1"></p>

<p>2. Què fa un ésser viu quan es relaciona?</p>
<div>
<span class="option" onclick="selectOption(this,false,'r2')">Dorm tot el dia</span>
<span class="option" onclick="selectOption(this,true,'r2')">Nota el que passa i respon</span>
<span class="option" onclick="selectOption(this,false,'r2')">No fa res</span>
</div>
<p id="r2"></p>

<p>Resposta curta:</p>
<p>Escriu el nom d’una funció vital.</p>

</div>

<div class="progress-container">
<div class="progress-bar"></div>
</div>

<div class="controls">
<button onclick="startReading('normal')">Lectura normal</button>
<button onclick="startReading('slow')">Lectura lenta</button>
<button onclick="pauseReading()">Pausa</button>
<button onclick="resumeReading()">Reprendre</button>
<button onclick="stopReading()">Stop</button>
<button onclick="prevPage()">Anterior</button>
</div>

</div>

</body>
</html>
